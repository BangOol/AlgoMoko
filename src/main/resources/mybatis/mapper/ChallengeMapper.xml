<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper	namespace="com.co.algomoko.challenge.mapper.ChallengeMapper">
	<!-- 챌린지 조회 -->
	<select id="getPage" resultType="com.co.algomoko.challenge.domain.ChallengeVO">
	select *
	from challenge
	where cno = #{cno}
	</select>	
	<!-- 챌린지 목록 -->
	<select id="cList" resultType="com.co.algomoko.challenge.domain.ChallengeVO">
	<![CDATA[select *
		 	 from (select * from challenge
		 		   where ctitle like '%' || #{ctitle,jdbcType=VARCHAR} || '%'
		 		   order by cno)
			 where rownum <=6]]>
	</select>
	<!-- 챌린지 작성 -->
	<insert id="cInsert" parameterType="com.co.algomoko.challenge.domain.ChallengeVO">
	insert into challenge (cno, ctitle, ccon, cdday, filepath, filename)
	values(CNO.nextval, #{ctitle}, #{ccon}, #{cdday}, #{filepath}, #{filename})
	</insert>		
	<!-- 챌린지 수정 -->
	<update id="cUpdate" parameterType="com.co.algomoko.challenge.domain.ChallengeVO">
	update challenge
	set ctitle = #{ctitle}, ccon = #{ccon}, cdday = #{cdday}, filepath = #{filepath}, filename = #{filename}
	where cno = #{cno}
	</update>	
	<!-- 챌린지 삭제 -->
	<delete id="cDelete" parameterType="int">
	delete
	from challenge
	where cno = #{cno}
	</delete>
	<!-- 진행중인 챌린지 추가 -->
	<insert id="mcInsert" parameterType="int">
	insert into my_challenge (mycno, cno2, mid, sdate, edate )
	values(mycno.nextval, #{cno}, '진휘용', to_char(sysdate, 'YYYY-MM-DD'), to_char(sysdate+30, 'YYYY-MM-DD'))
	</insert>
	<!--진행중인 챌린지 목록  -->
	<select id="mcList" resultType="com.co.algomoko.challenge.domain.MyChallengeVO">
	select *
	from challenge a, my_challenge b
	where a.cno = b.cno2
	</select>		
	<!-- 진행중인 챌린지 상세 -->	
	<select id="dList" resultType="com.co.algomoko.challenge.domain.ChallengeValidationVO">
	select *
	from challenge a
    join my_challenge b
    on a.cno = b.cno2 
    left outer join challenge_validation c 
    on  b.cno2 = c.cno3
    where a.cno = #{cno}
	</select>
	<!-- 챌린지 간소화인증 이동  -->
	<select id="getd" resultType="com.co.algomoko.challenge.domain.MyChallengeVO">
	select * 
	from my_challenge
	where cno2 = #{cno2}
	</select>
	<!-- 챌린지 간소화인증 -->
	<update id="valid" parameterType="com.co.algomoko.challenge.domain.MyChallengeVO">
	update my_challenge
	set round = #{round}
	where cno2 = #{cno2}
	</update>
</mapper>